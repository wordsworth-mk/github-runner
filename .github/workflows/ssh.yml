# https://zhuanlan.zhihu.com/p/387389708?utm_id=0

name: ğŸŸ¢ SSH

on:
  workflow_dispatch:
    inputs:
      KEEY_ALIVE:
        type: boolean
        description: "æ˜¯å¦ä¿æŒé•¿è¿æ¥ï¼ˆå¦åˆ™ 15 åˆ†é’Ÿæ–­å¼€è¿æ¥ï¼‰"
        required: false
        default: false

env:
  FONT_DIR: mypy/assets/font
  ENV_INIT_SCRIPT: mypy/env_init.sh
  DEPENDENT_BINARY: "ffmpeg unoconv libreoffice poppler-utils"

jobs:
  SSH:
    runs-on: ubuntu-latest
    steps:
      - name: æ‹‰å–ä»£ç 
        uses: actions/checkout@v4
        env:
          MYPY_ACCESS_TOKEN: ${{ secrets.MYPY_ACCESS_TOKEN || secrets.GITHUB_TOKEN }}
        with:
          token: ${{ env.MYPY_ACCESS_TOKEN }}
          repository: M-Kepler/Python

      - name: è®¾ç½®æ—¶åŒº
        uses: szenius/set-timezone@v2.0
        with:
          timezoneLinux: "Asia/Shanghai"
          timezoneWindows: "China Standard Time"

      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: 3.9

      - name: å®‰è£…ä¾èµ–ç¨‹åº
        uses: ConorMacBride/install-package@v1.1.0
        with:
          apt: ${{ env.DEPENDENT_BINARY }}

      - name: å®‰è£…å­—ä½“
        if: ${{ ! inputs.SIMPLE_RUN }}
        run: |
          bash mypy/build/install_font.sh ${{ env.FONT_DIR }}

      - name: åˆå§‹åŒ–è¿è¡Œç¯å¢ƒ
        run: |
          bash ${{ env.ENV_INIT_SCRIPT }}

      - name: ä¿æŒ SSH é•¿è¿æ¥
        if: ${{ inputs.KEEY_ALIVE }}
        run: touch /tmp/keepalive

      ##################################################
      # ä»è¿™é‡Œå¼€å§‹æ˜¯å¯¹æœåŠ¡å™¨çš„é…ç½®
      ##################################################
      - name: ä¿æŒ SSH é•¿è¿æ¥
        if: ${{ inputs.KEEY_ALIVE }}
        run: touch /tmp/keepalive

      - name: è®¾ç½® Bash
        run: |
          set -o vi
          alias ..="cd .."
          alias ll='ls -l'
          alias la='ls -A'
          alias g='git'
          alias cls='clear'
          set show-all-if-ambiguous on
          set completion-ignore-case on

      # ä¼šå¡åœ¨è¿™é‡Œç­‰å¾…é“¾æ¥
      - name: åˆ›å»º SSH ä¼šè¯
        uses: csexton/debugger-action@master

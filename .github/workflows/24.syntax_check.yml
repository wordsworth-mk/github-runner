name: 24. ğŸš¥ ä»£ç è´¨é‡æ£€æŸ¥

on:
  workflow_call:
    inputs:
      BASE_PATH:
        required: true
        type: string

    # å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™æä¾› token ç”¨æ¥æ‹‰å–æœ¬ç§æœ‰ä»“åº“
    secrets:
      MYPY_ACCESS_TOKEN:
        required: false

jobs:
  # ä»£ç è´¨é‡
  code_quality:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        # è®¿é—®ä»“åº“ç”¨åˆ°çš„ Personal access token
        env:
          MYPY_ACCESS_TOKEN: ${{ secrets.MYPY_ACCESS_TOKEN || secrets.GITHUB_TOKEN }}
        with:
          token: ${{ env.MYPY_ACCESS_TOKEN }}
          repository: M-Kepler/Python

      - name: Flake8 æ£€æŸ¥
        run: |
          pip install flake8 > /dev/null 2>&1
          flake8 --config mypy/.flake8 ${{ inputs.BASE_PATH }}
          [ $? == 0 ] && echo "flake8 success"

      - name: Pylint æ£€æŸ¥
        continue-on-error: true # å³ä½¿å¤±è´¥äº†ä¹Ÿç»§ç»­åç»­æµç¨‹
        run: |
          pip install pylint > /dev/null 2>&1
          # pylint å‘½ä»¤æ‰§è¡Œè¿”å›ç é 0 çš„è¯ï¼Œåé¢çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œçš„
          pylint --rcfile mypy/.pylintrc ${{ inputs.BASE_PATH }} -r y || true
          # ä¸è®º pylint ç»“æœå¦‚ä½•ï¼Œå§‹ç»ˆæ˜¯ 0
          # pylint_ret=$?

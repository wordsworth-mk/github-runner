name: 07. ğŸŸ¢ app_auto_course

on:
  workflow_dispatch:
    inputs:
      COURSE_URL:
        description: "è¯¾ç¨‹åœ°å€"
        required: true
        type: string

      WEIXIN_NICKNAME:
        description: "weixin æ˜µç§°"
        required: false
        default: ""
        type: string

      LOGIN_NAME:
        description: "ç™»å½•è´¦å·"
        required: true
        type: string

      LOGIN_PWD:
        description: "ç™»å½•å¯†ç "
        required: true
        type: string

      MISSION_BATCH_MODE:
        description: "è¯¾ä»¶å­¦ä¹ æ¨¡å¼"
        type: choice
        # å®šä¹‰åœ¨ auto_course/main.py ä¸‹
        default: "one_by_one"
        required: true
        options:
          - "one_by_one"
          - "multi"

      DO_EXAM:
        description: "æ˜¯å¦è‡ªåŠ¨è€ƒè¯•"
        required: false
        default: "yes"
        type: choice
        options:
          - "yes"
          - "no"

      PLATFORM:
        description: "å­¦ä¹ å¹³å°"
        required: true
        default: "huayi"
        type: choice
        options:
          - "huayi"
          - "haoyisheng"

      LOGIN_TYPE:
        description: "ç™»å½•è´¦å·ç±»å‹"
        type: choice
        default: "1"
        required: true
        options:
          - "1" # ç”¨æˆ·å
          - "3" # é‚®ç®±
          - "4" # èº«ä»½è¯

      REF:
        description: "Python ä»“åº“åˆ†æ”¯æˆ–æ ‡ç­¾ã€æäº¤ID"
        type: string
        required: false
        default: "master"

  # è¯¥äº‹ä»¶å¯ä»¥é€šè¿‡ API è§¦å‘
  repository_dispatch:
    types:
      - app_auto_course

jobs:
  note:
    runs-on: ubuntu-latest
    steps:
      - name: åˆ›å»ºå£°æ˜æ–‡ä»¶
        # annotation_level:å¯é€‰ failure notice
        run: |
          cat << EOF > ./annotations.json
          [
            {
              "file": "path/to/file.js",
              "line": 5,
              "title": "ç”¨æˆ·: ${{ inputs.WEIXIN_NICKNAME || github.event.client_payload.WEIXIN_NICKNAME }}",
              "message": "è¯¾ç¨‹: ${{ inputs.COURSE_URL || github.event.client_payload.COURSE_URL }}",
              "annotation_level": "notice"
            }
          ]
          EOF
          cat ./annotations.json
      - name: Annotate
        uses: yuzutech/annotations-action@v0.4.0
        with:
          repo-token: "${{ secrets.GITHUB_TOKEN }}"
          title: "lint"
          input: "./annotations.json"

  run_app:
    uses: wordsworth-mk/github-runner/.github/workflows/21.run.yml@main
    with:
      APP: auto_course
      WITH_3PARTY: false
      ARGS: >-
        -u "${{ inputs.COURSE_URL || github.event.client_payload.COURSE_URL }}"
        -t ${{ inputs.LOGIN_TYPE || github.event.client_payload.LOGIN_TYPE }}
        -n ${{ inputs.LOGIN_NAME || github.event.client_payload.LOGIN_NAME }}
        -p ${{ inputs.LOGIN_PWD || github.event.client_payload.LOGIN_PWD }}
        -m ${{ inputs.MISSION_BATCH_MODE || github.event.client_payload.MISSION_BATCH_MODE }}
        -f ${{ inputs.PLATFORM || github.event.client_payload.PLATFORM || 'huayi' }}
        -e ${{ inputs.DO_EXAM || github.event.client_payload.DO_EXAM || 'yes' }}
        -w ${{ inputs.WEIXIN_NICKNAME || github.event.client_payload.WEIXIN_NICKNAME || 'UNKNOW' }}
      REF: ${{ inputs.REF || github.event.client_payload.REF }}
      COMMIT_CHANGE: false
      DEPENDENT_BINARY: ""

    secrets:
      MYPY_ACCESS_TOKEN: ${{ secrets.MYPY_ACCESS_TOKEN }}

name: 09. ğŸŸ¢ action_test

on:
  # è¯¥äº‹ä»¶å¯ä»¥é€šè¿‡ API è§¦å‘
  repository_dispatch:
    types:
      - mypy_event_type.test_app

  # æ‰‹åŠ¨è§¦å‘æ—¶è¾“å…¥å‚æ•°
  workflow_dispatch:
    inputs:
      ARGS:
        description: "æ’ç­å‚æ•°ç”¨é€—å·åˆ†éš”: 0 è¡¨ç¤ºä¼‘æ¯ 1 è¡¨ç¤ºä¸Šç­ 2 è¡¨ç¤ºå¤œç­ 3 è¡¨ç¤ºå¤‡ç­"
        required: false
        type: string
        default: ""

      REF:
        description: "åˆ†æ”¯æˆ–æ ‡ç­¾ã€æäº¤ID"
        type: choice
        required: false
        options:
          - "master"
          - "release"

      SIMPLE_RUN:
        description: "æ˜¯å¦ç®€å•è¿è¡Œï¼ˆä¸å®‰è£…ç¨‹åºä¾èµ–å’Œå­—ä½“ï¼‰"
        type: boolean
        required: false
        default: true

      ENV_PUBLISH_PLATFORMS:
        type: string
        description: "é€‰æ‹©å‘å¸ƒå¹³å°ï¼Œç”¨ ',' åˆ†å‰²ï¼ˆä¸å¸¦ç©ºæ ¼ï¼Œå¯é€‰é¡¹: douyin,wechat,xiaohongshuï¼‰"
        required: false
        default: "douyin"

      ENV_PUBLISH_MOD:
        type: choice
        description: "é€‰æ‹©å‘å¸ƒæ—¶é—´æ¨¡å¼"
        required: false
        default: "timing"
        options:
          - "now"
          - "timing"

      ENV_DOUYIN_PUBLISH_ACCOUNT:
        type: choice
        description: "é€‰æ‹©æŠ–éŸ³è´¦å·"
        required: false
        default: "large"
        options:
          - "large"
          - "middle"
          - "test"

      DEBUG:
        description: "æ˜¯å¦ detach åˆ°è™šæ‹Ÿæœº"
        type: boolean
        required: false
        default: false

env:
  APP_BASE_PATH: mypy/apps
  # æŠŠ github action çš„ input è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: åˆ›å»ºæµ‹è¯•æ–‡ä»¶
        shell: bash
        run: |
          echo "xxxxxx" > ../mylog.txt

      - name: è¾“å‡ºåˆ°é¡µé¢ä¸Š
        shell: bash
        run: |
          cat ../mylog.txt > $GITHUB_STEP_SUMMARY

  run:
    # NOTICE: å¦‚æœæ‚¨æ˜¯é€šè¿‡ repository_dispatch è§¦å‘å·¥ä½œæµï¼Œéœ€è¦ä½¿ç”¨ github.event.client_payload.[å‚æ•°] æ¥ä¼ é€’å‚æ•°
    uses: wordsworth-mk/github-runner/.github/workflows/21.run.yml@main
    with:
      # ç¯å¢ƒå˜é‡
      ENV_PUBLISH_MOD: ${{ github.event.inputs.ENV_PUBLISH_MOD }}
      ENV_PUBLISH_PLATFORMS: ${{ github.event.inputs.ENV_PUBLISH_PLATFORMS }}
      ENV_DOUYIN_PUBLISH_ACCOUNT: ${{ github.event.inputs.ENV_DOUYIN_PUBLISH_ACCOUNT }}

      APP: test_app
      ARGS: ${{ inputs.ARGS || github.event.client_payload.ARGS }}
      REF: ${{ inputs.REF }}
      SIMPLE_RUN: ${{ inputs.SIMPLE_RUN || github.event.client_payload.SIMPLE_RUN }}
      # COMMIT_CHANGE: ${{ inputs.COMMIT_CHANGE || github.event.client_payload.COMMIT_CHANGE || false }}
      COMMIT_CHANGE: false
      DEBUG: ${{ inputs.DEBUG }}
    secrets:
      MYPY_ACCESS_TOKEN: ${{ secrets.MYPY_ACCESS_TOKEN }}

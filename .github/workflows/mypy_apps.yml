name: ğŸš€ æ¯æ—¥æ„å»º

on:
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
    inputs:
      SKIP_CASE_MARK:
        description: "case mark to skip ('none' means skip no cases)"
        required: false
        # default: "app douyin"
        default: "none"

# NOTICE: env ä¸Šä¸‹æ–‡åªèƒ½åœ¨ run æ­¥éª¤ä¸­ä½¿ç”¨
env:
  BASE_PATH: mypy
  APP_BASE_PATH: mypy/apps

jobs:
  ###########################################
  # è¯­æ³•æ£€æŸ¥
  ###########################################
  syntax_check:
    # ä¸€æ¬¡æ€§å…¨éƒ¨æ£€æŸ¥
    uses: M-Kepler/Python/.github/workflows/syntax_check.yml@master
    with:
      APP_PATH: mypy

  ###########################################
  # å•å…ƒæµ‹è¯• å’Œ ä»£ç è¦†ç›–ç‡æŠ¥å‘Š
  ###########################################
  unittest_and_coverage:
    name: Unittest
    needs:
      - syntax_check

    uses: M-Kepler/Python/.github/workflows/unittest.yml@master
    # è¦åœ¨ with å­å¥ä¸­ä¼ é€’ç¯å¢ƒå˜é‡ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ secrets æˆ– inputs
    with:
      CASE_PATH: mypy/tests
      # ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶
      DEPENDENT_BINARY: "ffmpeg unoconv libreoffice poppler-utils"
      NOT_RUN_MARK: ${{ inputs.SKIP_CASE_MARK }}
    secrets:
      ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}

  ###########################################
  # è·å–æŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å¤¹å¹¶å°†å®ƒä»¬ä½œä¸ºå˜é‡ä½¿ç”¨
  # OK
  ###########################################
  # get_apps:
  #   runs-on: ubuntu-latest
  #   # è®¾ç½®è¾“å‡ºï¼Œå¯åœ¨å¤šä¸ªä½œä¸šé—´ä¼ é€’å‚æ•°
  #   outputs:
  #     apps: ${{ steps.set-matrix.outputs.apps }}

  #   steps:
  #     - uses: actions/checkout@v4
  #     - name: Find directories and set as output
  #       id: set-matrix
  #       run: |
  #         apps=$(bash ${{ env.BASE_PATH }}/build/get_apps.sh ${{ env.APP_BASE_PATH }})
  #         echo "found apps: $apps"
  #         # key=value æ ¼å¼
  #         echo "apps=[$apps]" >> $GITHUB_OUTPUT
  #         echo "base_path=${{ env.BASE_PATH }}" >> $GITHUB_OUTPUT
  #
  # ###########################################
  # # æ‰“åŒ… OK
  # ###########################################
  # # æ²¡å¿…è¦ä¸€ä¸ªä¸ªè®¾ç½®ç¯å¢ƒå†æ‰“åŒ…
  # package:
  #   needs:
  #     - syntax_check
  #     - get_apps
  #     - unittest_and_coverage
  #   uses: M-Kepler/Python/.github/workflows/package.yml@master
  #
  #   # ä½¿ç”¨å‰é¢çš„ job çš„è¾“å‡º
  #   strategy:
  #     matrix:
  #       apps: ${{ fromJSON(needs.get_apps.outputs.apps) }}
  #   with:
  #     APPS_PATH: mypy/apps
